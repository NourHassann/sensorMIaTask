# MPU6050_Task1

---

this code is used to calculte the Yaw angle buy MPU6050 by organized steps as follow:

### config the MPU

---

1. first i2c communcation is used
2. we write 0 to the power_config register 

```cpp
Wire.beginTransmission(IMU_Address); 
  Wire.write(PWR_MGMT); 
  Wire.write(0x00); 
  Wire.endTransmission();
```

## config the gyroscope and accelometer

---

we write 18 in hexa to the gyroConfig address and 8 to accelconfig

18 make it to fullscale, 8 make it to 4g scale

```cpp
Wire.beginTransmission(IMU_Address); 
  Wire.write(GYRO_CONFIG); 
  Wire.write(0x18); 
  Wire.endTransmission();
  Wire.beginTransmission(IMU_Address); 
  Wire.write(ACCEL_CONFIG); 
  Wire.write(0x08); 
  Wire.endTransmission();
```

take the reading of the accelXYZ

- fun is defined to access the 16Bit of each direction

```cpp
acc_X = Wire.read()<<8 | Wire.read();
```

- the reading for all registers is taked by this way and also for the gyroscope

### calibration for the reading

since the sensor has the zero error so after we power it on we will get average for the reading to remove it from the actual reading 

the number of sample should be large number so i put it 3000

### taking sample reading

1. the offset which is calculted in the calibration will be removed from the final result 
2. the reading will get by access every register after the calibration and save it in the variable 
3. the reading is raw value so we will convert it to the actual value by this formule 

![Screenshot 2023-09-06 212007.png](MPU6050_Task1%205f8aa5dc882b4ff08c64578836c94fd8/Screenshot_2023-09-06_212007.png)

### Getting  the Yaw angle by gyro

the Gylo for the Z axis considered the rate of change for the angle yaw 

1. first we will initialize time = 0
2. then we will call the fun to get the sample 
3. then we will calculte the time taken in this process
4. calc the difference between the two time
5. update the old time by the time taken 
6. multiply it by the Gulo_Z and you have the yaw angle

### Getting the yaw be accelometer

I found this formule in the internet which get the yaw angle as the angle between vector x and vector y+z 

the result is in radian so i convert it to degree 

```cpp
yaw = atan2(sqrt(acc_Y*acc_Y+acc_Z*acc_Z),acc_X)*180/PI;
```

### the noise

the gyroscope and the accelometer affected by the noise so i use complementry filter in my code 

- it combines the readings for the gylo and the accel by multiple them by complementry factor
- i put 0.9 as complementry factor
- the accelometer affected more by noise so the less amount go to them

```cpp
FinalYaw = (1-complementryRatio)*yaw + complementryRatio*yaw_gyro;
```

# the answer to the filter question

i found that Low pass filter is used commonly with the MPU6050

in the datasheet, I found the cutoff freq for the accelometer should be more than 10HZ

the cuttoff freq for the gyroscope should be more than 100Hz

it also good to know that not just the cutoff affected the quality of the filter but the sampling freqancy as it should be high number

![Screenshot 2023-09-06 213321.png](MPU6050_Task1%205f8aa5dc882b4ff08c64578836c94fd8/Screenshot_2023-09-06_213321.png)

![Screenshot 2023-09-06 213501.png](MPU6050_Task1%205f8aa5dc882b4ff08c64578836c94fd8/Screenshot_2023-09-06_213501.png)